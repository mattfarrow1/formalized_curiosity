---
title: "Recreating VLOOKUP in R"
author: "Matt Farrow"
date: "2019-11-13"
output: html_document
categories:
  - R
tags:
  - excel
  - dplyr
slug: recreating-vlookup-in-r
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
draft: yes
---



<p>I recently gave a <a href="../../talk/2019-apra-excel/">talk on Excel</a> that focused on pivot tables and the VLOOKUP function. Recreating the power of VLOOKUP is easy in R using the <a href="https://dplyr.tidyverse.org">dplyr</a> package from the <a href="https://www.tidyverse.org">tidyverse</a>.</p>
<pre class="r"><code># Load dplyr package
library(dplyr)</code></pre>
<p>One of the examples I used was collapsing research ratings into more broad “buckets” for principal, major, and leadership gift-rated prospects. We’ll start be making a rating lookup table that contains all our ratings along with a corresponding “bucket.” This could also be stored in a .csv or .xlsx file and loaded in separately.</p>
<pre class="r"><code>rating_lookup &lt;-
  as_tibble(list(
    rating = c(
      &quot;A - $2.5M to $5M&quot;,
      &quot;B - $1M to $2.5M&quot;,
      &quot;C - $500,000 to $1M&quot;,
      &quot;D - $250,000 to $499,999&quot;,
      &quot;E - $100,000 to $249,999&quot;,
      &quot;G - $50,000 to $99,999&quot;,
      &quot;H - $25,000 to $49,999&quot;,
      &quot;I - $10,000 to $24,999&quot;
    ),
    rating_bucket = c(&quot;PG&quot;, &quot;PG&quot;, &quot;MG&quot;, &quot;MG&quot;, &quot;MG&quot;, &quot;LG&quot;, &quot;LG&quot;, &quot;LG&quot;)
  ))

# view our new lookup table
rating_lookup</code></pre>
<pre><code>## # A tibble: 8 x 2
##   rating                   rating_bucket
##   &lt;chr&gt;                    &lt;chr&gt;        
## 1 A - $2.5M to $5M         PG           
## 2 B - $1M to $2.5M         PG           
## 3 C - $500,000 to $1M      MG           
## 4 D - $250,000 to $499,999 MG           
## 5 E - $100,000 to $249,999 MG           
## 6 G - $50,000 to $99,999   LG           
## 7 H - $25,000 to $49,999   LG           
## 8 I - $10,000 to $24,999   LG</code></pre>
<p>Now, we’ll make a sample dataset with ID numbers along with ratings.</p>
<pre class="r"><code>df &lt;-
  as_tibble(list(
    # create an id column using the numbers 1 through 50
    lookup_id = 1:50,
    # create a rating column by randomly sampling our previously generated ratings 50 times
    rating = sample(rating_lookup$rating, size = 50, replace = TRUE)
  ))

# look at only the first 10 observations
head(df, n = 10)</code></pre>
<pre><code>## # A tibble: 10 x 2
##    lookup_id rating                  
##        &lt;int&gt; &lt;chr&gt;                   
##  1         1 B - $1M to $2.5M        
##  2         2 C - $500,000 to $1M     
##  3         3 A - $2.5M to $5M        
##  4         4 G - $50,000 to $99,999  
##  5         5 G - $50,000 to $99,999  
##  6         6 G - $50,000 to $99,999  
##  7         7 G - $50,000 to $99,999  
##  8         8 E - $100,000 to $249,999
##  9         9 D - $250,000 to $499,999
## 10        10 D - $250,000 to $499,999</code></pre>
<p>Now that we have our dataset as well as our lookup table, we can merge our rating buckets into our dataset using the <a href="https://dplyr.tidyverse.org/reference/join.html"><code>left_join</code></a> function.</p>
<pre class="r"><code>df &lt;- left_join(df, rating_lookup, by = &quot;rating&quot;)

# look at only the first 10 observations
head(df, n = 10)</code></pre>
<pre><code>## # A tibble: 10 x 3
##    lookup_id rating                   rating_bucket
##        &lt;int&gt; &lt;chr&gt;                    &lt;chr&gt;        
##  1         1 B - $1M to $2.5M         PG           
##  2         2 C - $500,000 to $1M      MG           
##  3         3 A - $2.5M to $5M         PG           
##  4         4 G - $50,000 to $99,999   LG           
##  5         5 G - $50,000 to $99,999   LG           
##  6         6 G - $50,000 to $99,999   LG           
##  7         7 G - $50,000 to $99,999   LG           
##  8         8 E - $100,000 to $249,999 MG           
##  9         9 D - $250,000 to $499,999 MG           
## 10        10 D - $250,000 to $499,999 MG</code></pre>
<p>Finally, we can use dplyr’s <a href="https://dplyr.tidyverse.org/reference/tally.html"><code>count</code></a> function to recreate some of the power of Excel’s pivot tables.</p>
<pre class="r"><code>count(df, rating_bucket, name = &quot;prospects&quot;)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   rating_bucket prospects
##   &lt;chr&gt;             &lt;int&gt;
## 1 LG                   15
## 2 MG                   23
## 3 PG                   12</code></pre>
