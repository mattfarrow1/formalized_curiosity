---
title: Fixing a Date Problem
author: Matt Farrow
date: '2019-09-08'
categories:
  - R
slug: fixing-a-date-problem
lastmod: '2019-09-08T14:59:58-05:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
---



<div id="do-as-i-say-not-as-i-do" class="section level3">
<h3>Do as I say, not as I do</h3>
<p>I recently had some sloppy coding result in incorrect reports being generated so I’m documenting my fix here to own up to my error and document my steps to solve the problem.</p>
<p>For this set of reports, I download the results of four queries from our database and run an <code>R</code> script to clean, organize, and distribute a set of reports for each fundraiser. I’ll talk more about the specifics of how that works in a future post.</p>
<p>My problem this week came from these two lines of code:</p>
<pre class="r"><code>data_pulled &lt;- Sys.Date()
data_pulled &lt;- &quot;2019-08-15&quot;</code></pre>
<div id="do-you-see-the-problem" class="section level4">
<h4>Do you see the problem?</h4>
<p>I’m first defining the variable <code>data_pulled</code> using the system’s date. The second line changes that same variable to a hard coded date.</p>
</div>
<div id="whys-that-a-problem" class="section level4">
<h4>Why’s that a problem?</h4>
<p>Unless I’m only running this script on August 15, 2019, the date on my <code>data_pulled</code> variable is going to be wrong. In turn, I’ll be pulling the wrong data in every time. :grimacing:</p>
</div>
<div id="you-dummy.-whyd-you-do-that" class="section level4">
<h4>You dummy. Why’d you do that?</h4>
<p>I’m lazy. Not actively lazy per se, but in this case I took a sloppy shortcut that bit me. See, 9/10 times I’m going to be running this script on the same day that I download the data, hence my use of <code>Sys.Date</code>.</p>
<p>I have the 2nd definition of the <code>data_pulled</code> variable in case I have moments of re-running the month’s reports. This script is fairly new and therefore is still being tweaked from month to month depending on fundraiser feedback.</p>
<p>Most<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> of the time, I just comment out that 2nd line of code when I’m done:</p>
<pre class="r"><code>data_pulled &lt;- Sys.Date()
# data_pulled &lt;- &quot;2019-08-15&quot;</code></pre>
<p>This time I forgot that step and ended up using old data for my current month’s reports. :speak_no_evil:</p>
</div>
</div>
<div id="the-solution" class="section level3">
<h3>The Solution</h3>
<p>My first step in running this report is to download the data and save it to my RStudio project in a <code>/data-raw/</code> folder with subfolders for the dates that I pull the data i.e. <code>/data - raw/2019-08-01/</code>.</p>
<p>There are probably half a dozen ways to solve this problem, but the solution I think I’m going to take is to parse the subfolder names, convert them to dates, and find the most recent date and set that as the <code>data_pulled</code> variable.</p>
<pre class="r"><code>library(tidyverse)
library(lubridate)</code></pre>
<pre class="r"><code># Read in the list of folders in the specified directory.
data_pulled &lt;- tibble::enframe(list.dirs(&quot;data - raw/&quot;, full.names = FALSE))

# Select only the column containing the folder names and convert them to dates.
data_pulled &lt;- data_pulled %&gt;% 
  dplyr::select(2) %&gt;% 
  lubridate::ymd(data_pulled$value)

data_pulled &lt;- max(data_pulled, na.rm = TRUE)</code></pre>
<p>I can now pull in the most recent set of data without any manual checks on my part.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>I recognize <em>most</em> is not the same as <em>all</em>, hence this post.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
